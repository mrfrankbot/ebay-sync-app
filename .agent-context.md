# Agent Context — eBay Sync App (Listing Automation Platform)

Read this BEFORE writing any code. These rules are non-negotiable.

## Critical Safety Rules
1. **NEVER sync orders without a date filter.** The `syncOrders()` function in `order-sync.ts` has a hard 7-day max lookback guard. DO NOT remove or bypass it. On 2026-02-11, a sync without a date filter pulled ALL historical eBay orders into Shopify → Lightspeed POS. It took hours to clean up.
2. **NEVER delete production data** — no DROP TABLE, no bulk DELETE without explicit approval.
3. **DO NOT modify the order sync safety guard** in `src/sync/order-sync.ts` (the MAX_LOOKBACK_DAYS block).

## Architecture
- **Stack:** Express + TypeScript + better-sqlite3 + Drizzle ORM + Polaris React UI
- **DB:** SQLite at ~/.clawdbot/ebaysync.db (or DATABASE_PATH env var)
- **Frontend:** Vite + React + Polaris + TanStack React Query v5
- **Deploy:** Railway (auto-deploys on push to main)
- **Two GitHub remotes:** origin (mrfrankbot) + chris (chrisbachmaxwell)

## React Query v5 Gotchas
- No `onSuccess` in useQuery — use `useEffect` watching `data` instead
- `keepPreviousData` → `placeholderData: keepPreviousData` (import from @tanstack/react-query)
- Polaris `Text` components require `as="p"` or `as="span"` prop

## Key Files
- `src/db/client.ts` — DB init, table creation, seed data
- `src/sync/attribute-mapping-service.ts` — mapping CRUD + per-product overrides
- `src/server/routes/api.ts` — 44+ API endpoints (the backend is solid, usually frontend-only changes)
- `src/sync/order-sync.ts` — order sync with safety guard
- `src/server/routes/shopify-webhooks.ts` — incoming Shopify webhooks

## Environment
- `OPENAI_API_KEY` — for chat AI + auto-listing pipeline
- `PHOTOROOM_API_KEY` — for image processing (optional)
- `API_KEY` — for external API access (x-api-key header)
- `SHOPIFY_API_KEY`, `SHOPIFY_API_SECRET` — Shopify app credentials
- `EBAY_CLIENT_ID`, `EBAY_CLIENT_SECRET` — eBay API credentials

## Build
`npm run build` — must pass clean (tsc + vite). Always verify before committing.
